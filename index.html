<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Iris â€” Visual Novel</title>
  <style>
    :root{
      --max-width:800px;
      --ui-pad:20px;
      --textbox-bg: rgba(0,0,0,0.6);
      --textbox-color: #ffffff;
      --choice-bg: #fff;
      --choice-color: #000;
      --font: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{
      margin:0;
      height:100%;
      background:#000;
      font-family:var(--font);
      color:var(--textbox-color);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 20px;
      box-sizing:border-box;
    }

    #game{
      width:100%;
      max-width:var(--max-width);
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
    }

    #stage{
      width:80vw;
      max-width:var(--max-width);
      aspect-ratio: 4/3;
      background: #111;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border-radius:10px;
    }

    #character{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      user-select:none;
    }

    #textbox{
      width:80vw;
      max-width:var(--max-width);
      background:var(--textbox-bg);
      padding:var(--ui-pad);
      box-sizing:border-box;
      border-radius:10px;
      font-size:20px;
      line-height:1.4;
      cursor:pointer;
      text-align:left;
      position:relative;
      min-height:72px;
      color:var(--textbox-color);
    }

    #textbox .caret {
      display:inline-block;
      width:10px;
      height:1.1em;
      background:var(--textbox-color);
      margin-left:6px;
      opacity:0.9;
      vertical-align:middle;
      animation: blink 1s steps(1) infinite;
    }
    @keyframes blink { 50% { opacity:0 } }

    #choices{
      width:80vw;
      max-width:var(--max-width);
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:stretch;
      text-align:center;
    }

    .choice{
      display:block;
      background:var(--choice-bg);
      color:var(--choice-color);
      padding:10px;
      border-radius:10px;
      cursor:pointer;
      font-size:18px;
      user-select:none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .choice:active { transform: translateY(1px); }

    @media (max-width:420px){
      #textbox{ font-size:18px; padding:16px; }
      .choice{ font-size:16px; padding:10px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="game" role="application" aria-label="Visual novel engine">
      <div id="stage" aria-hidden="false">
        <img id="character" alt="character portrait" src="" />
      </div>

      <div id="textbox" tabindex="0" role="button" aria-pressed="false" aria-label="Dialog box (click or press Space to advance)">
      </div>

      <div id="choices" aria-live="polite" aria-atomic="true"></div>
    </div>
  </div>

  <script>
    const textbox = document.getElementById('textbox');
    const choicesBox = document.getElementById('choices');
    const charEl = document.getElementById('character');

    let typing = false;
    let typeInterval = null;
    let currentText = "";
    let currentBranch = null;
    let branchStack = [];
    let branchIndex = 0;
    const typingSpeed = 28;

    const script = [
      { text: "It's just another day, like every other day", char: "" },
      { text: "You woke up, go through with your writings and scroll through your socials the entire day", char: "" },
      { text: "Spending hours and wasting your time online again and again for the sake of an ideology others won't justify", char: "" },
      { text: "Mindlessly in your own world, are you even human anymore after what you did?", char: "" },
      { text: "As your mind wander, thinking and contemplating who you really are", char: "" },
      { text: "You kept scrolling past the noises", char: "" },
      { text: "Until", char: "" },
      { text: ".....", char: "" },
      { text: "You noticed something", char: "" },
      { text: "You shouldn't notice it but you did", char: "" },
      { text: "Something caught your attention, while you're wasting your time", char: "" },
      { text: "You saw it, inside the comment section in a post from an unknown user", char: "" },
      { text: "As the closer you look through the comment section", char: "" },
      { text: "You haven't even realized, you were analysing each of them, their choice of profile and their username", char: "" },
      { text: "You don't know why, you have a feeling that someone is calling you, whispering into you to find them", char: "" },
      { text: "This is it.", char: "" },
      { text: "This is her", char: "" },
      { text: "The comment that stands out, the one that caught your attention...", char: "" },

      {
        text: "",
        choices: [
          {
            text: "Does it matter?",
            branch: [
              { text: "You cautiously walk left.", char: "" },
              { text: "The corridor is dark and eerie.", char: "" },
              { text: "You hear footsteps behind you.", char: "" },
              {
                text: "Do you confront them or run?",
                choices: [
                  {
                    text: "Confront",
                    branch: [
                      { text: "You stand your ground and face the shadow.", char: "" },
                      { text: "The shadow disappears. You feel relieved.", char: "" },
                      { text: "The path leads to a mysterious room.", char: "" },
                      { text: "End of Left Route", char: "" }
                    ]
                  },
                  {
                    text: "Run",
                    branch: [
                      { text: "You run as fast as you can.", char: "" },
                      { text: "You find a hidden exit.", char: "" },
                      { text: "End of Left Route", char: "" }
                    ]
                  }
                ]
              }
            ]
          },
          {
            text: "Take the other path",
            branch: [
              { text: "You turn right and find a glowing room.", char: "" },
              { text: "A mysterious figure gestures to you.", char: "" },
              {
                text: "Do you follow them or ignore?",
                choices: [
                  {
                    text: "Follow",
                    branch: [
                      { text: "You follow the figure into the unknown.", char: "" },
                      { text: "A door closes behind you.", char: "" },
                      { text: "You find a hidden treasure.", char: "" },
                      { text: "End of Right Route", char: "" }
                    ]
                  },
                  {
                    text: "Ignore",
                    branch: [
                      { text: "You ignore the figure and continue alone.", char: "" },
                      { text: "You get lost in the dark.", char: "" },
                      { text: "GAME OVER", char: "" }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ];

    function clearChoices(){
      choicesBox.innerHTML = '';
      choicesBox.style.display = 'none';
    }

    function showCharacter(src){
      if(src){
        charEl.src = src;
        charEl.style.display = 'block';
      } else {
        charEl.style.display = 'none';
      }
    }

    function typewrite(text, speed = typingSpeed, onComplete = ()=>{}){
      typing = true;
      currentText = text || "";
      textbox.innerHTML = '';
      let i = 0;
      const span = document.createElement('span');
      textbox.appendChild(span);
      const caret = document.createElement('span');
      caret.className = 'caret';
      textbox.appendChild(caret);

      clearInterval(typeInterval);
      typeInterval = setInterval(()=>{
        span.textContent += text[i] || '';
        i++;
        if(i >= text.length){
          clearInterval(typeInterval);
          typing = false;
          span.textContent = text;
          onComplete();
        }
      }, speed);
    }

    function finishTypingImmediately(){
      if(!typing) return;
      clearInterval(typeInterval);
      typing = false;
      textbox.innerHTML = '';
      const span = document.createElement('span');
      span.textContent = currentText;
      textbox.appendChild(span);
      const caret = document.createElement('span');
      caret.className = 'caret';
      textbox.appendChild(caret);
      const scene = currentBranch[branchIndex];
      if(scene && scene.choices) populateChoices(scene.choices);
    }

    function populateChoices(choices){
      clearChoices(); 
      choicesBox.style.display = 'flex';
      choices.forEach((c, idx)=>{
        const btn = document.createElement('div');
        btn.className = 'choice';
        btn.tabIndex = 0;
        btn.textContent = (choices.length>1?`${idx+1}. `:'') + c.text;
        btn.onclick = () => {
          clearChoices();
          branchStack.push({ branch: currentBranch, index: branchIndex+1 });
          currentBranch = c.branch;
          branchIndex = 0;
          showScene();
        };
        btn.onkeydown = (e)=>{ if(e.key==='Enter'||e.key===' ') btn.click(); };
        choicesBox.appendChild(btn);
      });
      if(choicesBox.firstChild) choicesBox.firstChild.focus();
    }

    function showScene(){
      const scene = currentBranch[branchIndex];
      if(!scene) {
        if(branchStack.length>0){
          const popped = branchStack.pop();
          currentBranch = popped.branch;
          branchIndex = popped.index;
          showScene();
        }
        return;
      }

      if(scene.hasOwnProperty('char')) showCharacter(scene.char);

      if(scene.text){
        typewrite(scene.text, typingSpeed, ()=>{
          if(scene.choices) populateChoices(scene.choices);
        });
      } else if(scene.choices){
        populateChoices(scene.choices);
      }
    }

    textbox.addEventListener('click', ()=>{
      const scene = currentBranch[branchIndex];
      if(typing){ finishTypingImmediately(); return; }
      if(scene && scene.choices) return;
      branchIndex++;
      showScene();
    });

    document.addEventListener('keydown', (e)=>{
      const scene = currentBranch[branchIndex];
      if(e.key===' '||e.key==='Enter'){
        e.preventDefault();
        if(typing){ finishTypingImmediately(); return; }
        if(scene && scene.choices){ if(choicesBox.firstChild) choicesBox.firstChild.focus(); return; }
        branchIndex++;
        showScene();
      }
      if(!typing && scene && scene.choices){
        const n = parseInt(e.key,10);
        if(!isNaN(n)&&n>=1&&n<=scene.choices.length){
          const choice = scene.choices[n-1];
          if(choice){ clearChoices(); branchStack.push({ branch: currentBranch, index: branchIndex+1 }); currentBranch = choice.branch; branchIndex=0; showScene(); }
        }
      }
    });

    (function init(){
      currentBranch = script;
      branchIndex = 0;
      const first = currentBranch[0];
      if(first && first.char){ const img = new Image(); img.src=first.char; }
      showScene();
      textbox.focus();
    })();

    window.vn = { script, showScene, finishTypingImmediately };
  </script>
</body>
</html>