<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Visual Novel Engine</title>

  <style>
    :root{
      --max-width:900px;
      --ui-pad:20px;
      --textbox-bg: rgba(0,0,0,0.65);
      --textbox-color:#fff;
      --font: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    html,body{
      margin:0;
      height:100%;
      background:#000;
      font-family:var(--font);
      color:var(--textbox-color);
    }

    .wrap{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:24px;
      box-sizing:border-box;
    }

    #game{
      width:100%;
      max-width:var(--max-width);
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    #stage{
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      background:#111;
      overflow:hidden;
      border-radius:12px;
    }

    #background{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .sprite{
      position:absolute;
      bottom:0;
      max-height:100%;
      transition:opacity .3s;
      pointer-events:none;
    }

    .left{ left:2%; }
    .right{ right:2%; }
    .hidden{ opacity:0; }

    #textbox{
      background:var(--textbox-bg);
      padding:var(--ui-pad);
      border-radius:12px;
      font-size:20px;
      min-height:80px;
      cursor:pointer;
    }

    .caret{
      display:inline-block;
      width:10px;
      height:1.1em;
      background:#fff;
      margin-left:6px;
      animation:blink 1s steps(1) infinite;
    }

    @keyframes blink{50%{opacity:0}}

    #choices{
      display:none;
      flex-direction:column;
      gap:8px;
    }

    .choice{
      background:#fff;
      color:#000;
      padding:12px;
      border-radius:10px;
      text-align:center;
      cursor:pointer;
    }
  </style>
</head>

<body>
<div class="wrap">
  <div id="game">

    <div id="stage">
      <img id="background" src="https://cdn.discordapp.com/attachments/1417112659937067102/1461828007797719234/IMG20251205023931.jpg?ex=696bf8ec&is=696aa76c&hm=32cd013add662c006b1a36867209b83561be92b41ff267e746be270a931fdd87&.jpg" />
      <img id="spriteLeft" class="sprite left hidden"
        src="https://cdn.discordapp.com/attachments/1417112659937067102/1461823423540891892/BackgroundEraser_20260117_044229015.png?ex=696bf4a7&is=696aa327&hm=35714efb47c2a134e557615f3d05db794cfad555da7f39ab6c203b864333d7b4&.jpg" />
      <img id="spriteRight" class="sprite right hidden"
        src="https://cdn.discordapp.com/attachments/1417112659937067102/1461827284011843746/BackgroundEraser_20260117_045919420.png?ex=696bf83f&is=696aa6bf&hm=dc7e93f223e342bffa850521134b0b4be52324febf82219d1defa5010977fe89&.jpg" />
    </div>

    <div id="textbox"></div>
    <div id="choices"></div>

  </div>
</div>

<script>
/* ===== ELEMENTS ===== */
const textbox = document.getElementById('textbox');
const choicesBox = document.getElementById('choices');
const bg = document.getElementById('background');
const leftSprite = document.getElementById('spriteLeft');
const rightSprite = document.getElementById('spriteRight');

/* ===== STATE ===== */
let typing = false;
let readyForNext = false;
let currentText = "";
let timer = null;
const speed = 28;

/* ===== ENGINE ===== */
function setBackground(src){ bg.src = src || ""; }

function setLeftSprite(src){
  if(src){ leftSprite.src = src; leftSprite.classList.remove('hidden'); }
  else leftSprite.classList.add('hidden');
}

function setRightSprite(src){
  if(src){ rightSprite.src = src; rightSprite.classList.remove('hidden'); }
  else rightSprite.classList.add('hidden');
}

function clearChoices(){
  choicesBox.innerHTML="";
  choicesBox.style.display="none";
}

function showChoices(list){
  clearChoices();
  choicesBox.style.display="flex";
  list.forEach(c=>{
    const btn=document.createElement('div');
    btn.className='choice';
    btn.textContent=c.text;
    btn.onclick=c.onSelect;
    choicesBox.appendChild(btn);
  });
}

function typeText(text){
  typing = true;
  readyForNext = false;
  currentText = text;
  textbox.innerHTML = "";

  const span = document.createElement('span');
  const caret = document.createElement('span');
  caret.className = "caret";
  textbox.append(span, caret);

  let i = 0;
  clearInterval(timer);
  timer = setInterval(()=>{
    span.textContent += text[i] || "";
    i++;
    if(i >= text.length){
      clearInterval(timer);
      typing = false;
      span.textContent = text;
      readyForNext = true;
    }
  }, speed);
}

function skipTyping(){
  if(!typing) return;
  clearInterval(timer);
  typing = false;
  textbox.innerHTML = currentText + '<span class="caret"></span>';
  readyForNext = true;
}

/* ===== TAP LOGIC ===== */
textbox.onclick = () => {
  if(typing){
    skipTyping();
    return;
  }
  if(readyForNext && choicesBox.style.display !== "flex"){
    readyForNext = false;
    nextScene();
  }
};

/* ===== STORY ===== */
let scene = 0;

function nextScene(){
  scene++;
  runScene();
}

function runScene(){
  clearChoices();

  switch(scene){
    case 0:
      setBackground("https://cdn.discordapp.com/attachments/1417112659937067102/1461828007797719234/IMG20251205023931.jpg?ex=696bf8ec&is=696aa76c&hm=32cd013add662c006b1a36867209b83561be92b41ff267e746be270a931fdd87&.jpg");
      setLeftSprite(null);
      setRightSprite(null);
      typeText("You reached a dimly lit area. Everything seems quiet.");
      break;

    case 1:
      typeText("You breathe a sigh of relief, trying to calm yourself.");
      break;

    case 2:
      setLeftSprite(leftSprite.src);
      typeText("Where am I...?");
      break;

    case 3:
      showChoices([
        { text:"Look around", onSelect:()=>{scene=4; runScene();} },
        { text:"Keep running", onSelect:()=>{scene=7; runScene();} }
      ]);
      break;

    case 4:
      typeText("Does it really matter?");
      break;

    case 5:
      setRightSprite(rightSprite.src);
      typeText("???: You haven't killed yourself yet.");
      break;

    case 6:
      typeText("I'm sorry.");
      break;

    case 7:
      typeText("You run as fast as you can. The voice fades into silence.");
      break;

    case 8:
      setLeftSprite(null);
      setRightSprite(null);
      typeText("I could never forgive myself.");
      break;
  }
}

/* START */
runScene();
</script>
</body>
</html>